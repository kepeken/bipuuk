---
layout: docs
permalink: /docs/bangau/
title: 木のナンバリング
---

それぞれの木に一意な番号をふります。

基本的には写像 `f: N × N -> N` を考えます。（数学的に言えば、自然数が自由マグマをなすような二項演算であればいい、となるんでしょうか（よくわからない））


## 方法

具体的には色々考えられます。現在は四角埋めに落ち着いていますが、とりあえず紹介しておきます。


### 2べき

[https://twitter.com/kepeken/status/1029774623787765760](https://twitter.com/kepeken/status/1029774623787765760)

```
f(x, y) = 2 ** m * (2 * n + 1)
```

インフレが激しいため不採用です。


### 三角埋め

|x \ y|  0|  1|  2|  3|  4|
|:---:|:-:|:-:|:-:|:-:|:-:|
|__0__|  1|  3|  6| 10| 15|
|__1__|  2|  5|  9| 14|   |
|__2__|  4|  8| 13|   |   |
|__3__|  7| 12|   |   |   |
|__4__| 11|   |   |   |   |

後述の四角埋めのほうが都合が良かったので廃止しました。


### 四角埋め

[https://twitter.com/kepeken/status/1031492656528941059](https://twitter.com/kepeken/status/1031492656528941059)

|x \ y|  0|  1|  2|  3|  4|
|:---:|:-:|:-:|:-:|:-:|:-:|
|__0__|  1|  4|  9| 16| 25|
|__1__|  2|  3|  8| 15| 24|
|__2__|  5|  6|  7| 14| 23|
|__3__| 10| 11| 12| 13| 22|
|__4__| 17| 18| 19| 20| 21|

現在採用している案です。特徴として番号順がそのまま高さ順になっているため、例えば木の高さによって品詞を決定すれば、

- 造語するとき自然数の範囲から選ぶだけで良い
- 単語が他の単語を部分木として含まないようにできる（一意分解できる）

などの利点があることから採用しました。


### 往復埋め

|x \ y|  0|  1|  2|  3|  4|
|:---:|:-:|:-:|:-:|:-:|:-:|
|__0__|  1|  4|  5| 16| 17|
|__1__|  2|  3|  6| 15| 18|
|__2__|  9|  8|  7| 14| 19|
|__3__| 10| 11| 12| 13| 20|
|__4__| 25| 24| 23| 22| 21|

四角埋めに加わる特徴として、自然数の差が１である木同士の編集距離も１になっています。それによる利点が特に思いつかない割に計算が面倒なので、採用を見送っています。


### Z階数曲線

[Z階数曲線 - Wikipedia](https://ja.wikipedia.org/wiki/Z%E9%9A%8E%E6%95%B0%E6%9B%B2%E7%B7%9A)

|x \ y|  0|  1|  2|  3|  4|
|:---:|:-:|:-:|:-:|:-:|:-:|
|__0__|  1|  3|  9| 11|   |
|__1__|  2|  4| 10| 12|   |
|__2__|  5|  7| 13| 15|   |
|__3__|  6|  8| 14| 16|   |
|__4__| 17|   |   |   |   |

[Yuki さんの提案](https://twitter.com/Yuki_jukjis/status/1108569158529110016) によるものです。

ビット演算で高速に処理ができることが利点です。

文法を考えるにあたって四角埋めの性質が面白そうなのでZ階数曲線の採用は見送っていますが、Z階数曲線にも文法に利用できそうな性質があったら採用するかもしれません。
